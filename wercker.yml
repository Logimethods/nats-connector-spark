box: lmagnin/docker-maven-nats

build:
  steps:
    - xenoterracide/maven:
        name: Compile & Test
        goals: compile test

deploy_snapshot:
  steps:
    - xenoterracide/maven:
        name: Deploy Jar File
        goals: -s ./settings.xml -Dmaven.test.skip=true clean deploy
        

deploy:
  steps:
    - script:
        name: Store keys
        code: |
          export ASC_DIRECTORY=$(pwd)/pgp
          mkdir pgp
          mkdir /root/.gnupg
          echo "${SONATYPE_PGP_KEYS_64}" | base64 -d > ./pgp/keys.asc
          ls -als ./pgp
          more ./pgp/pubring.asc
          gpg --version
          gpg --import ./pgp/keys.asc
    - xenoterracide/maven:
        name: Sign & Deploy Artifacts
        goals: -s ./settings.xml -Dmaven.test.skip=true clean verify deploy -Dgpg.passphrase="$SONATYPE_PASSPHRASE"
        
javadoc:
  steps:
    - script:
        name: Configure Git
        code: |-
          git config --global user.email "$GITHUB_EMAIL"
          git config --global user.name "$GITHUB_USERNAME"
    - xenoterracide/maven:
        name: Deploy Javadoc to Github Pages
        goals: -s ./settings.xml clean install -Dmaven.test.skip=true scm-publish:publish-scm
