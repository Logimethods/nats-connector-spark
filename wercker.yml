box: lmagnin/docker-maven-nats
build:
  steps:
    - xenoterracide/maven:
        goals: compile test
deploy:
  steps:
    - xenoterracide/maven:
        name: Deploy jar file
        goals: -s ./settings.xml deploy
        
javadoc:
  steps:
    # https://github.com/wercker/support/issues/48
    - install-packages:
        packages: git openssh-client
    - add-to-known_hosts:
        # https://github.com/wercker/step-add-to-known_hosts
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - add-ssh-key:
        keyname: GIT_PRIVATE_SSH_KEY
    - xenoterracide/maven:
        name: Deploy Javadoc to github pages
        goals: -e -X -s ./settings.xml clean install scm-publish:publish-scm

gh-pages:
  steps:
    # https://github.com/lvivier/step-gh-pages
    - lukevivier/gh-pages:
        token: $GIT_OAUTH2TOKEN
        domain: com.logimethods
        basedir: target/apidocs

# http://blog.wercker.com/2013/07/25/Using-wercker-to-publish-to-GitHub-pages.html        
deploy-doc :
  steps :
    - script:
        name: Configure git
        code: |-
          git config --global user.email "laurent.magnin@logimethods.com"
          git config --global user.name "laugimethods"

          # remove current .git folder
          rm -rf .git
    - script:
        name: Deploy to github pages
        code: |-
          git init
          git add .
          git commit -m "deploy commit from $WERCKER_STARTED_BY"
          git push -f $GIT_OAUTH2TOKEN master:gh-pages

# https://github.com/leipert/step-git-push      
push-doc:
  steps:
    - leipert/git-push:
         gh_oauth: $GIT_OAUTH2TOKEN
         gh_pages: true
         gh_pages_domain: logimethods.com
         basedir: target/apidocs